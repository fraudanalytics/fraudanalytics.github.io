<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>

  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>PiML Toolbox</title>
  

  
  <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  <link rel="stylesheet" href="../../_static/css/vendor/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
<script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>

</head>

<body class="wy-body-for-nav">

  


<nav id="navbar" class="sk-docs-navbar navbar navbar-expand-md navbar-light bg-light py-0">
  <div class="container-fluid sk-docs-container px-0">
      <a class="navbar-brand py-0" href="../../index.html">
        <img
          class="sk-brand-img"
          src="../../_static/piml-logo.png"
          alt="logo"/>
      </a>
    <button
      id="sk-navbar-toggler"
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="sk-navbar-collapse collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../install.html">Install</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../user_guide.html">User Guide</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../modules/classes.html">API</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../auto_examples/index.html">Examples</a>
        </li>
     </ul>
      <div id="searchbox" role="search">
          <div class="searchformwrapper">
          <form class="search" action="../../search.html" method="get">
            <input class="sk-search-text-input" type="text" name="q" aria-labelledby="searchlabel" />
            <input class="sk-search-text-btn" type="submit" value="Go" />
          </form>
          </div>
      </div>
    </div>
  </div>
</nav>
  <div class="d-flex" id="sk-doc-wrapper">
      <input type="checkbox" name="sk-toggle-checkbox" id="sk-toggle-checkbox">
      <label id="sk-sidemenu-toggle" class="sk-btn-toggle-toc btn sk-btn-primary" for="sk-toggle-checkbox">Toggle Menu</label>
      <div id="sk-sidebar-wrapper" class="border-right">
        <div class="sk-sidebar-toc-wrapper">
          <div class="sk-sidebar-toc-logo">
            <a href="../../index.html">
              <img
                class="sk-brand-img"
                src="../../_static/piml-logo.png"
                alt="logo"/>
            </a>
          </div>
          <!--div class="btn-group w-100 mb-2" role="group" aria-label="rellinks">
              <a href="xgb1.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="5.5. XGBoost Depth 1">Prev</a><a href="../models.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="5. Interpretable Models">Up</a>
              <a href="ebm.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="5.7. Explainable Boosting Machines">Next</a>
          </div-->
              <div class="sk-sidebar-toc">
              
                <ul>
                
                
                
                
                
                
                <li>
                  <a href="../../user_guide.html" class="sk-toc-active">User Guide</a>
                </li>
                <ul>
                
                  <li>
                    <a href="../introduction.html" class="">1. Introduction</a>
                    
                  </li>
                
                  <li>
                    <a href="../data.html" class="">2. Data Pipeline</a>
                    
                  </li>
                
                  <li>
                    <a href="../train.html" class="">3. Model Train and Tune</a>
                    
                  </li>
                
                  <li>
                    <a href="../explain.html" class="">4. Post-hoc Explainability</a>
                    
                  </li>
                
                  <li>
                    <a href="../models.html" class="sk-toc-active">5. Interpretable Models</a>
                    
                    <ul>
                      
                        <li class="sk-toctree-l3">
                          <a href="glm.html">5.1. Generalized Linear Models</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="gam.html">5.2. Generalized Additive Model</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="tree.html">5.3. Decision Tree</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="figs.html">5.4. Fast Interpretable Greedy-tree Sums</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="xgb1.html">5.5. XGBoost Depth 1</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="">5.6. XGBoost Depth 2</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="ebm.html">5.7. Explainable Boosting Machines</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="gaminet.html">5.8. GAMI-Net</a>
                        </li>
                      
                        <li class="sk-toctree-l3">
                          <a href="reludnn.html">5.9. ReLU Neural Network</a>
                        </li>
                      
                    </ul>
                    
                  </li>
                
                  <li>
                    <a href="../testing.html" class="">6. Diagnostic Suite</a>
                    
                  </li>
                
                  <li>
                    <a href="../compare.html" class="">7. Model Comparison</a>
                    
                  </li>
                
                  <li>
                    <a href="../cases.html" class="">8. Case Studies</a>
                    
                  </li>
                
                </ul>
                
                
                </ul>
              </div>
        </div>
      </div>
      <div id="sk-page-content-wrapper">
        <div class="sk-page-content container-fluid body px-md-3" role="main">
          
  <style type="text/css">
  div.body div.toctree-wrapper ul {
      padding-left: 0;
  }

  div.body li.toctree-l1 {
      padding: 0 0 0.5em 0;
      list-style-type: none;
      font-size: 150%;
      font-weight: bold;
  }

  div.body li.toctree-l2 {
      font-size: 70%;
      list-style-type: square;
      font-weight: normal;
      margin-left: 40px;
  }

  div.body li.toctree-l3 {
      font-size: 85%;
      list-style-type: circle;
      font-weight: normal;
      margin-left: 40px;
  }

  div.body li.toctree-l4 {
      margin-left: 40px;
  }

</style><section id="xgboost-depth-2">
<h1><span class="section-number">5.6. </span>XGBoost Depth 2<a class="headerlink" href="#xgboost-depth-2" title="Permalink to this heading">¶</a></h1>
<p>XGBoost depth 2 (XGB2) uses the XGBoost algorithm but with a maximum tree depth of 2. The model fitting process for XGB2 is the same as for raw XGBoost models. However, the main difference between XGB2 and XGBoost lies in their interpretation. In the context of functional ANOVA, an XGB2 model can be expressed as a GAM with pairwise interactions (GAMI). Once an XGB2 model is well-trained, we can extract the leaf node information from all the trees and restructure the model into an equivalent GAMI model.</p>
<div class="math notranslate nohighlight">
\[\begin{align}
   g(\mathbb{E}(y|\textbf{x}))  = \mu + \sum\limits_{j} h_{j}(x_{j}) + \sum\limits_{j&lt;k} f_{jk}(x_{j},x_{k}),  \tag{1}
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span> is the global intercept, <span class="math notranslate nohighlight">\(h_{j}(x_{j})\)</span> is main effect, and <span class="math notranslate nohighlight">\(f_{jk}(x_{j}, x_{k})\)</span> is pairwise interaction.</p>
<p><strong>Effects Aggregation.</strong> Once an XGB2 model is fit, we can extract the main effects and pairwise interactions by aggregating the leaf node information in the following way:</p>
<ul class="simple">
<li><p>Leaf nodes with only one split variable correspond to the main effects.</p></li>
<li><p>Leaf nodes with two different split variables correspond to pairwise interactions.</p></li>
</ul>
<p>Similar to XGB1, we can collect the unique splits for each feature or feature pair, and then calculate the accumulated leaf node values for each 1D or 2D bin generated by the unique splits.</p>
<p><strong>Effects Purification.</strong> To ensure a unique representation of the GAMI model, we perform a purification step for each pairwise interaction by setting its conditional mean to zero. The removed effects are then added to their corresponding main effects. The iterative purification method proposed in <a class="reference internal" href="../introduction.html#lengerich2020" id="id1"><span>[Lengerich2020]</span></a> is used for this purpose. Given the 2D value matrix of a pairwise interaction <span class="math notranslate nohighlight">\((j, k)\)</span>, the algorithm proceeds as follows:</p>
<ul class="simple">
<li><p>Calculate the mean of <span class="math notranslate nohighlight">\(\hat{f}_{jk}\)</span> within each bin of the feature <span class="math notranslate nohighlight">\(j\)</span>. Subtract the mean vector from the value matrix, and add the mean vector to the main effect <span class="math notranslate nohighlight">\(\hat{h}_{j}\)</span>.</p></li>
<li><p>Calculate the mean of <span class="math notranslate nohighlight">\(\hat{f}_{jk}\)</span> within each bin of the feature <span class="math notranslate nohighlight">\(k\)</span>. Subtract the mean vector from the value matrix, and add the mean vector to the main effect <span class="math notranslate nohighlight">\(\hat{h}_{k}\)</span>.</p></li>
</ul>
<p>Repeat the above steps until the value matrix converges. The final value matrix is the purified pairwise interaction <span class="math notranslate nohighlight">\((j, k)\)</span>. Similarly, to ensure model identifiability, we also subtract the mean of each main effect, so that each main effect has zero means. The removed value is then added to the intercept term.</p>
<p>Empirically, XGB2 has demonstrated superior predictive performance over some black-box models. It can also be fitted with <strong>monotonicity</strong> constraints to make the model more interpretable. Additionally, we can prune some trivial effects to make the model more parsimonious.</p>
<section id="model-training">
<h2><span class="section-number">5.6.1. </span>Model Training<a class="headerlink" href="#model-training" title="Permalink to this heading">¶</a></h2>
<p>Here, we use the Bike Sharing dataset as an example to demonstrate the usage of the XGB2 model, as follows.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">piml.models</span> <span class="kn">import</span> <span class="n">XGB2Regressor</span>
<span class="n">exp</span><span class="o">.</span><span class="n">model_train</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">XGB2Regressor</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>The <a class="reference external" href="../../modules/generated/piml.models.XGB2Regressor.html">XGB2Regressor</a> (as well as <a class="reference external" href="../../modules/generated/piml.models.XGB2Classifier.html">XGB2Classifier</a>) is a wrapper of the <a class="reference external" href="https://xgboost.readthedocs.io/en/stable/python/python_api.html">xgboost</a> Python package and it inherits some commonly used hyperparameters in XGB, e.g., <code class="docutils literal notranslate"><span class="pre">n_estimators</span></code>, <code class="docutils literal notranslate"><span class="pre">eta</span></code>, <code class="docutils literal notranslate"><span class="pre">tree_method</span></code>, <code class="docutils literal notranslate"><span class="pre">max_bin</span></code>, <code class="docutils literal notranslate"><span class="pre">gamma</span></code>, <code class="docutils literal notranslate"><span class="pre">reg_lambda</span></code>, and <code class="docutils literal notranslate"><span class="pre">reg_alpha</span></code>.</p>
<p>Similar to XGB1, XGB2 supports monotonic constraints. For example, if you want to enforce the monotonic increasing constraint on the feature “hr”, then you can set <code class="docutils literal notranslate"><span class="pre">mono_increasing_list=(&quot;hr&quot;)</span></code>, also see the details <a class="reference external" href="./xgb1.html#model-training">here</a>.</p>
</section>
<section id="global-interpretation">
<h2><span class="section-number">5.6.2. </span>Global Interpretation<a class="headerlink" href="#global-interpretation" title="Permalink to this heading">¶</a></h2>
<p>In addition to the main effect and feature importance plots in XGB1, XGB2 also supports interaction and effect importance plots.</p>
<section id="main-effect-plot">
<h3><span class="section-number">5.6.2.1. </span>Main Effect Plot<a class="headerlink" href="#main-effect-plot" title="Permalink to this heading">¶</a></h3>
<p>The main effect plot in XGB2 shows the estimated effect <span class="math notranslate nohighlight">\(\hat{h}_{j}(x_{j})\)</span> against the feature <span class="math notranslate nohighlight">\(x_{j}\)</span>, represented as a piecewise constant function. In PiMl, users can use the “global_effect_plot” keyword to generate main effect plots for a particular feature by specifying its name in the <code class="docutils literal notranslate"><span class="pre">uni_feature</span></code> parameter.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_interpret</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;global_effect_plot&quot;</span><span class="p">,</span> <span class="n">uni_feature</span><span class="o">=</span><span class="s2">&quot;atemp&quot;</span><span class="p">,</span>
                    <span class="n">original_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/3_models/plot_5_xgb2_reg.html"><img alt="../../_images/sphx_glr_plot_5_xgb2_reg_002.png" src="../../_images/sphx_glr_plot_5_xgb2_reg_002.png" /></a>
</figure>
<p>The plot illustrates the impact of the <code class="docutils literal notranslate"><span class="pre">atemp</span></code> feature (normalized feeling temperature in Celsius. The values are divided into 50) on bike sharing and includes its corresponding histogram. The data indicate that the peak of bike sharing activity occurs when <code class="docutils literal notranslate"><span class="pre">atemp</span></code> is around 0.7, which is considered a comfortable temperature for outdoor activities. Any temperature that is either cooler or hotter than this range tends to reduce people’s willingness to ride bicycles.</p>
</section>
<section id="interaction-plot">
<h3><span class="section-number">5.6.2.2. </span>Interaction Plot<a class="headerlink" href="#interaction-plot" title="Permalink to this heading">¶</a></h3>
<p>To visualize the estimated pairwise interaction, we can still use the keyword “global_effect_plot,” specifying the feature names in <code class="docutils literal notranslate"><span class="pre">bi_features</span></code>. The interaction plot shows the estimated interaction value matrix <span class="math notranslate nohighlight">\(\hat{f}_{jk}(x_{j},x_{k})\)</span> against <span class="math notranslate nohighlight">\(x_{j}\)</span> and <span class="math notranslate nohighlight">\(x_{k}\)</span>.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_interpret</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;global_effect_plot&quot;</span><span class="p">,</span> <span class="n">bi_features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hr&quot;</span><span class="p">,</span> <span class="s2">&quot;season&quot;</span><span class="p">],</span>
                    <span class="n">sliced_line</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">original_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/3_models/plot_5_xgb2_reg.html"><img alt="../../_images/sphx_glr_plot_5_xgb2_reg_003.png" src="../../_images/sphx_glr_plot_5_xgb2_reg_003.png" /></a>
</figure>
<p>The estimated pairwise interaction between <code class="docutils literal notranslate"><span class="pre">hr</span></code> and <code class="docutils literal notranslate"><span class="pre">season</span></code> is shown in the figure above. Similar to two-way PDP and ALE, the interaction heatmap can be viewed via sliced 1D line plot, by setting <code class="docutils literal notranslate"><span class="pre">sliced_line=True</span></code>. (This is the same for all the GAMI models, including EBM, GAMI-Net)</p>
</section>
<section id="effect-importance">
<h3><span class="section-number">5.6.2.3. </span>Effect Importance<a class="headerlink" href="#effect-importance" title="Permalink to this heading">¶</a></h3>
<p>The effect importance is calculated as the variance of the estimated shape functions, which is similar to the feature importance in GAM. The effect importance can be calculated for both main effects and pairwise interactions. We use the keyword “global_ei” to draw the effect importance plot.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_interpret</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;global_ei&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/3_models/plot_5_xgb2_reg.html"><img alt="../../_images/sphx_glr_plot_5_xgb2_reg_004.png" src="../../_images/sphx_glr_plot_5_xgb2_reg_004.png" /></a>
</figure>
<p>Here we only plot the top-10 effect importance. It can be observed that the main effect of <code class="docutils literal notranslate"><span class="pre">hr</span></code> is the most important, followed by <code class="docutils literal notranslate"><span class="pre">atemp</span></code> and the pairwise interaction between <code class="docutils literal notranslate"><span class="pre">hr</span></code> and <code class="docutils literal notranslate"><span class="pre">workingday</span></code>. Note that this plot only shows the top 10 effects with the largest importance. To get the full results, you can set the parameter <code class="docutils literal notranslate"><span class="pre">return_data</span></code> to True.</p>
</section>
<section id="feature-importance">
<h3><span class="section-number">5.6.2.4. </span>Feature Importance<a class="headerlink" href="#feature-importance" title="Permalink to this heading">¶</a></h3>
<p>The feature importance of XGB2 is different from that of GAM. Due to the existence of interaction effects, we need to aggregate the effects of each feature. This is done by summing the effects of each feature over the main effect and all related pairwise interactions.</p>
<div class="math notranslate nohighlight">
\[\begin{align}
   \hat{z}_{j}(x_{j})  = \hat{h}_{j}(x_{j}) + \frac{1}{2} \sum\limits_{j &lt; k} \hat{f}_{jk}(x_{j}, x_{k}),  \tag{2}
\end{align}\]</div>
<p>Feature importance is calculated as the variance of <span class="math notranslate nohighlight">\(\hat{z}_{j}(x_{j})\)</span>, then normalized such that they sum up to 1. Similarly, we use the keyword “global_fi” to draw the feature importance plot.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_interpret</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;XGB2&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;global_fi&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/3_models/plot_5_xgb2_reg.html"><img alt="../../_images/sphx_glr_plot_5_xgb2_reg_005.png" src="../../_images/sphx_glr_plot_5_xgb2_reg_005.png" /></a>
</figure>
<p>From this plot, we can observe that the two features <code class="docutils literal notranslate"><span class="pre">hr</span></code> and <code class="docutils literal notranslate"><span class="pre">atemp</span></code> take the dominant role in the model, followed by <code class="docutils literal notranslate"><span class="pre">season</span></code> and <code class="docutils literal notranslate"><span class="pre">hum</span></code>. Note that this plot only shows the top 10 features with the largest importance. To get the full results, you can set the parameter <code class="docutils literal notranslate"><span class="pre">return_data</span></code> to True.</p>
</section>
</section>
<section id="local-interpretation">
<h2><span class="section-number">5.6.3. </span>Local Interpretation<a class="headerlink" href="#local-interpretation" title="Permalink to this heading">¶</a></h2>
<p>As XGB2 is a GAMI model, its local interpretation consists of two parts: local feature contribution and local effect contribution. The local interpretation shows how the predicted value is formed by the main effects and pairwise interactions.</p>
<section id="local-effect-contribution">
<h3><span class="section-number">5.6.3.1. </span>Local Effect Contribution<a class="headerlink" href="#local-effect-contribution" title="Permalink to this heading">¶</a></h3>
<p>Given a sample, the local effect contribution displays the outputs of each main effect <span class="math notranslate nohighlight">\(\hat{h}_{j}(x_{j})\)</span> and pairwise interaction <span class="math notranslate nohighlight">\(\hat{f}_{jk}(x_{j}, x_{k})\)</span>. In PiML, we use the keyword “local_ei” to draw the effect contribution of a sample specified by the <code class="docutils literal notranslate"><span class="pre">sample_id</span></code> parameter.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_interpret</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;XGB2&#39;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;local_ei&quot;</span><span class="p">,</span> <span class="n">sample_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">original_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/3_models/plot_5_xgb2_reg.html"><img alt="../../_images/sphx_glr_plot_5_xgb2_reg_006.png" src="../../_images/sphx_glr_plot_5_xgb2_reg_006.png" /></a>
</figure>
<p>The predictor values of each effect are shown on the right axis, and the corresponding effect names are shown on the left axis. From the title, we can see that the predicted value of this sample is 0.0606, which is slightly different from the actual response of 0.16. The predicted value 0.0606 is then additively decomposed as the summation of all effect contributions plus the intercept term (not shown in this plot). The main effect of <code class="docutils literal notranslate"><span class="pre">atemp</span></code> contributes the most to the final prediction, with a negative contribution (around -0.06). Followed by <code class="docutils literal notranslate"><span class="pre">atemp</span></code>, the main effect of <code class="docutils literal notranslate"><span class="pre">season</span></code> and the pairwise interaction (<code class="docutils literal notranslate"><span class="pre">hr</span></code>, <code class="docutils literal notranslate"><span class="pre">workingday</span></code>) also show negative contributions to the final prediction. Note that this plot only shows the top 10 effects with the largest contribution. To get the full results, you can set the parameter <code class="docutils literal notranslate"><span class="pre">return_data</span></code> to True.</p>
</section>
<section id="local-feature-contribution">
<h3><span class="section-number">5.6.3.2. </span>Local Feature Contribution<a class="headerlink" href="#local-feature-contribution" title="Permalink to this heading">¶</a></h3>
<p>The local feature contribution plot shows the aggregated local effect contribution of each feature. This is done by summing the local effect contribution of each feature over the main effect and all related pairwise interactions, i.e., <span class="math notranslate nohighlight">\(\hat{z}_{j}(x_{j})\)</span>. To draw the local feature contribution plot, we use the keyword “local_fi”.</p>
<div class="jupyter_cell jupyter_container docutils container">
<div class="cell_input code_cell docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp</span><span class="o">.</span><span class="n">model_interpret</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;XGB2&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="s2">&quot;local_fi&quot;</span><span class="p">,</span> <span class="n">sample_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">original_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<figure class="align-left">
<a class="reference external image-reference" href="../../auto_examples/3_models/plot_5_xgb2_reg.html"><img alt="../../_images/sphx_glr_plot_5_xgb2_reg_007.png" src="../../_images/sphx_glr_plot_5_xgb2_reg_007.png" /></a>
</figure>
<p>The interpretation of the feature contribution plot is similar to that of the local effect contribution plot, except that the contribution is shown by feature instead of effect. For this specific sample, the main effect of <code class="docutils literal notranslate"><span class="pre">atemp</span></code> and <code class="docutils literal notranslate"><span class="pre">season</span></code> still negatively contribute to the final prediction. In contrast to the positive contribution of its main effect, the feature <code class="docutils literal notranslate"><span class="pre">hr</span></code> shows a negative contribution from the feature level. Note that this plot only shows the top 10 features with the largest contribution. To get the full results, you can set the parameter <code class="docutils literal notranslate"><span class="pre">return_data</span></code> to True.</p>
</section>
</section>
<section id="examples">
<h2><span class="section-number">5.6.4. </span>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¶</a></h2>
<aside class="topic">
<p class="topic-title">Example 1: BikeSharing</p>
<blockquote>
<div><p>The first example below demonstrates how to use PiML with its high-code APIs for developing machine learning models for the BikeSharing data from the UCI repository, which consists of 17,389 samples of hourly counts of rental bikes in Capital bikeshare system; see details. The response <code class="docutils literal notranslate"><span class="pre">cnt</span></code> (hourly bike rental counts) is continuous and it is a regression problem.</p>
</div></blockquote>
<ul class="simple">
<li><p><a class="reference internal" href="../../auto_examples/3_models/plot_5_xgb2_reg.html#sphx-glr-auto-examples-3-models-plot-5-xgb2-reg-py"><span class="std std-ref">XGB-2 Regression (Bike Sharing)</span></a></p></li>
</ul>
</aside>
<aside class="topic">
<p class="topic-title">Examples 2: Taiwan Credit</p>
<blockquote>
<div><p>The second example below demonstrates how to use PiML’s high-code APIs for the TaiwanCredit dataset from the UCI repository. This dataset comprises the credit card details of 30,000 clients in Taiwan from April 2005 to September 2005, and more information can be found on the TaiwanCreditData website. The data can be loaded directly into PiML, although it requires some preprocessing. The FlagDefault variable serves as the response for this classification problem.</p>
</div></blockquote>
<ul class="simple">
<li><p><a class="reference internal" href="../../auto_examples/3_models/plot_5_xgb2_cls.html#sphx-glr-auto-examples-3-models-plot-5-xgb2-cls-py"><span class="std std-ref">XGB-2 Classification (Taiwan Credit)</span></a></p></li>
</ul>
</aside>
</section>
</section>


        </div>
      <div class="container">
        <footer class="sk-content-footer">
              &copy; Copyright 2022-, PiML-Toolbox authors.
            <a href="../../_sources/guides/models/xgb2.rst.txt" rel="nofollow">Show this page source</a>
        </footer>
      </div>
    </div>
  </div>


  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
      
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
  </script>

<script>
$(document).ready(function() {
    /* Add a [>>>] button on the top-right corner of code samples to hide
     * the >>> and ... prompts and the output and thus make the code
     * copyable. */
    var div = $('.highlight-python .highlight,' +
                '.highlight-python3 .highlight,' +
                '.highlight-pycon .highlight,' +
		'.highlight-default .highlight')
    var pre = div.find('pre');

    // get the styles from the current theme
    pre.parent().parent().css('position', 'relative');
    var hide_text = 'Hide prompts and outputs';
    var show_text = 'Show prompts and outputs';

    // create and add the button to all the code blocks that contain >>>
    div.each(function(index) {
        var jthis = $(this);
        if (jthis.find('.gp').length > 0) {
            var button = $('<span class="copybutton">&gt;&gt;&gt;</span>');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
            jthis.prepend(button);
        }
        // tracebacks (.gt) contain bare text elements that need to be
        // wrapped in a span to work with .nextUntil() (see later)
        jthis.find('pre:has(.gt)').contents().filter(function() {
            return ((this.nodeType == 3) && (this.data.trim().length > 0));
        }).wrap('<span>');
    });

    // define the behavior of the button when it's clicked
    $('.copybutton').click(function(e){
        e.preventDefault();
        var button = $(this);
        if (button.data('hidden') === 'false') {
            // hide the code output
            button.parent().find('.go, .gp, .gt').hide();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'hidden');
            button.css('text-decoration', 'line-through');
            button.attr('title', show_text);
            button.data('hidden', 'true');
        } else {
            // show the code output
            button.parent().find('.go, .gp, .gt').show();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'visible');
            button.css('text-decoration', 'none');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
        }
    });

	/*** Add permalink buttons next to glossary terms ***/
	$('dl.glossary > dt[id]').append(function() {
		return ('<a class="headerlink" href="#' +
			    this.getAttribute('id') +
			    '" title="Permalink to this term">¶</a>');
	});
  /*** Hide navbar when scrolling down ***/
  // Returns true when headerlink target matches hash in url
  (function() {
    hashTargetOnTop = function() {
        var hash = window.location.hash;
        if ( hash.length < 2 ) { return false; }

        var target = document.getElementById( hash.slice(1) );
        if ( target === null ) { return false; }

        var top = target.getBoundingClientRect().top;
        return (top < 2) && (top > -2);
    };

    // Hide navbar on load if hash target is on top
    var navBar = document.getElementById("navbar");
    var navBarToggler = document.getElementById("sk-navbar-toggler");
    var navBarHeightHidden = "-" + navBar.getBoundingClientRect().height + "px";
    var $window = $(window);

    hideNavBar = function() {
        navBar.style.top = navBarHeightHidden;
    };

    showNavBar = function() {
        navBar.style.top = "0";
    }

    if (hashTargetOnTop()) {
        hideNavBar()
    }

    var prevScrollpos = window.pageYOffset;
    hideOnScroll = function(lastScrollTop) {
        if (($window.width() < 768) && (navBarToggler.getAttribute("aria-expanded") === 'true')) {
            return;
        }
        if (lastScrollTop > 2 && (prevScrollpos <= lastScrollTop) || hashTargetOnTop()){
            hideNavBar()
        } else {
            showNavBar()
        }
        prevScrollpos = lastScrollTop;
    };

    /*** high performance scroll event listener***/
    var raf = window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        window.oRequestAnimationFrame;
    var lastScrollTop = $window.scrollTop();

    if (raf) {
        loop();
    }

    function loop() {
        var scrollTop = $window.scrollTop();
        if (lastScrollTop === scrollTop) {
            raf(loop);
            return;
        } else {
            lastScrollTop = scrollTop;
            hideOnScroll(lastScrollTop);
            raf(loop);
        }
    }
  })();
});

</script>
    

<script src="_static/js/vendor/bootstrap.min.js"></script>

</body>
</html>