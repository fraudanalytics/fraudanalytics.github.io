
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\4_testing\plot_8_scored_test_cls.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_4_testing_plot_8_scored_test_cls.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_4_testing_plot_8_scored_test_cls.py:


Scored Test: Classification
=====================================

.. GENERATED FROM PYTHON SOURCE LINES 7-16

.. code-block:: default

    import numpy as np
    from piml import Experiment
    from piml.models import XGB2Classifier

    exp = Experiment()
    exp.data_loader(data='TaiwanCredit', silent=True)
    exp.data_prepare(silent=True)
    exp.model_train(model=XGB2Classifier(), name='XGB2')








.. GENERATED FROM PYTHON SOURCE LINES 17-18

Extract the required data inputs from PiML workflow 

.. GENERATED FROM PYTHON SOURCE LINES 18-32

.. code-block:: default

    train_x, train_y, _ = exp.get_data(train=True)
    test_x, test_y, _ = exp.get_data(test=True)

    task_type = 'classification'
    X = np.concatenate([train_x, test_x], axis=0)
    y = np.concatenate([train_y, test_y], axis=0).ravel()
    prediction = exp.get_model("XGB2").estimator.predict(X)
    prediction_proba = exp.get_model("XGB2").estimator.predict_proba(X)[:, -1]
    feature_names = exp.get_feature_names()
    feature_types = exp.get_feature_types()
    target_name = exp.get_target_name()
    train_idx = np.arange(train_x.shape[0])
    test_idx = np.arange(train_x.shape[0], train_x.shape[0] + test_x.shape[0])








.. GENERATED FROM PYTHON SOURCE LINES 33-34

Prepare the necessary data information

.. GENERATED FROM PYTHON SOURCE LINES 34-45

.. code-block:: default

    data_dict = {'x': X,
                 'y': y,
                 'task_type': task_type,
                 'prediction': prediction,
                 'prediction_proba': prediction_proba,
                 'feature_names': feature_names,
                 'feature_types': feature_types,
                 'target_name': target_name,
                 'train_idx': train_idx,
                 'test_idx': test_idx}








.. GENERATED FROM PYTHON SOURCE LINES 46-47

Show the accuracy table 

.. GENERATED FROM PYTHON SOURCE LINES 47-50

.. code-block:: default

    from piml.scored_test import test_accuracy_table
    result = test_accuracy_table(**data_dict)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

              ACC      AUC      F1 LogLoss   Brier
                                              
    Train  0.8227   0.8059  0.4809  0.4147  0.1300
    Test   0.8292   0.7817  0.4831  0.4211  0.1310
    Gap    0.0065  -0.0242  0.0022  0.0064  0.0009




.. GENERATED FROM PYTHON SOURCE LINES 51-52

Show the accuracy plot 

.. GENERATED FROM PYTHON SOURCE LINES 52-55

.. code-block:: default

    from piml.scored_test import test_accuracy_plot
    result = test_accuracy_plot(**data_dict, figsize=(10, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_001.png
   :alt: Recall-Precision Curve, ROC Curve
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 56-57

Plot the prediction residuals against one feature of interest 

.. GENERATED FROM PYTHON SOURCE LINES 57-60

.. code-block:: default

    from piml.scored_test import test_accuracy_residual
    result = test_accuracy_residual(**data_dict, show_feature='PAY_1', figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_002.png
   :alt: Residual Plot
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 61-62

Run weakspot test to detect weak regions

.. GENERATED FROM PYTHON SOURCE LINES 62-65

.. code-block:: default

    from piml.scored_test import test_weakspot
    result = test_weakspot(**data_dict, slice_features=['PAY_1'], figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_003.png
   :alt: Weak Regions
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 66-67

Run overfit test to detect overfit regions

.. GENERATED FROM PYTHON SOURCE LINES 67-70

.. code-block:: default

    from piml.scored_test import test_overfit
    result = test_overfit(**data_dict, slice_method="histogram", slice_features=['PAY_1'], figsize=(5, 4))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    No overfit regions detected.




.. GENERATED FROM PYTHON SOURCE LINES 71-72

Run reliability test to get reliability diagram

.. GENERATED FROM PYTHON SOURCE LINES 72-75

.. code-block:: default

    from piml.scored_test import test_reliability_perf
    result = test_reliability_perf(**data_dict, figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_004.png
   :alt: Reliability Diagram (Quantile Bins)
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_004.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 76-77

Run reliability test to show relationship between prediction uncertainty and feature of interest 

.. GENERATED FROM PYTHON SOURCE LINES 77-80

.. code-block:: default

    from piml.scored_test import test_reliability_marginal
    result = test_reliability_marginal(**data_dict, show_feature='PAY_1', figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_005.png
   :alt: Marginal Uncertainty
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_005.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 81-82

Run reliability test to show data distance between reliable and unreliable samples. 

.. GENERATED FROM PYTHON SOURCE LINES 82-85

.. code-block:: default

    from piml.scored_test import test_reliability_distance
    result = test_reliability_distance(**data_dict, figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_006.png
   :alt: Distribution Shift: Unreliable vs. Remaining Regions
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_006.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 86-87

Run reliability test to get the calibrated predicted probability vs. original predicted probability. 

.. GENERATED FROM PYTHON SOURCE LINES 87-90

.. code-block:: default

    from piml.scored_test import test_reliability_calibration
    result = test_reliability_calibration(**data_dict, figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_007.png
   :alt: Isotonic Regression
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_007.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 91-92

Run resilience test to show how model performance changes under distributional shift.

.. GENERATED FROM PYTHON SOURCE LINES 92-95

.. code-block:: default

    from piml.scored_test import test_resilience_perf
    result = test_resilience_perf(**data_dict, figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_008.png
   :alt: Resilience Test
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_008.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 96-97

We can calculate the distributional difference between good regions and bad regions, e.g. the weak regions and the rest. Similarly, such plot can also be used for other tests, like reliablity. 

.. GENERATED FROM PYTHON SOURCE LINES 97-100

.. code-block:: default

    from piml.scored_test import test_resilience_distance
    result = test_resilience_distance(**data_dict, figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_009.png
   :alt: Distribution Shift: 10%-Worst vs Remaining
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_009.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 101-102

The distributional difference histogram plot. 

.. GENERATED FROM PYTHON SOURCE LINES 102-105

.. code-block:: default

    from piml.scored_test import test_resilience_shift_histogram
    result = test_resilience_shift_histogram(**data_dict, show_feature='PAY_1', figsize=(5, 4))




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_010.png
   :alt: Distribution Shift: 10%-Worst vs Remaining
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_010.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 106-107

The distributional difference density plot. 

.. GENERATED FROM PYTHON SOURCE LINES 107-109

.. code-block:: default

    from piml.scored_test import test_resilience_shift_density
    result = test_resilience_shift_density(**data_dict, show_feature='PAY_1', figsize=(5, 4))



.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_011.png
   :alt: Distribution Shift: 10%-Worst vs Remaining
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_8_scored_test_cls_011.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  21.636 seconds)

**Estimated memory usage:**  38 MB


.. _sphx_glr_download_auto_examples_4_testing_plot_8_scored_test_cls.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/selfexplainml/piml-toolbox/main?urlpath=lab/tree/./docs/_build/html/notebooks/auto_examples/4_testing/plot_8_scored_test_cls.ipynb
        :alt: Launch binder
        :width: 150 px



    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_8_scored_test_cls.py <plot_8_scored_test_cls.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_8_scored_test_cls.ipynb <plot_8_scored_test_cls.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
