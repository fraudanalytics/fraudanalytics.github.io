
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\4_testing\plot_6_fairness.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_4_testing_plot_6_fairness.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_4_testing_plot_6_fairness.py:


Fairness Test: XGB2
=====================================

.. GENERATED FROM PYTHON SOURCE LINES 8-9

Experiment initialization and data preparation

.. GENERATED FROM PYTHON SOURCE LINES 9-17

.. code-block:: default

    from piml import Experiment
    from piml.models import XGB2Classifier

    exp = Experiment()
    exp.data_loader("SimuCredit", silent=True)
    exp.data_summary(feature_exclude=["Race", "Gender"], silent=True)
    exp.data_prepare(target="Approved", task_type="classification", silent=True)








.. GENERATED FROM PYTHON SOURCE LINES 18-19

Train Model

.. GENERATED FROM PYTHON SOURCE LINES 19-26

.. code-block:: default

    exp.model_train(XGB2Classifier(max_depth=2,
                                   n_estimators=100, 
                                   mono_increasing_list=["Mortgage", "Balance"],
                                   mono_decreasing_list=["Amount Past Due", "Utilization", "Delinquency",
                                                         "Credit Inquiry", "Open Trade"]),
                    name="XGB2_monotonic")








.. GENERATED FROM PYTHON SOURCE LINES 27-28

Fairness Metric

.. GENERATED FROM PYTHON SOURCE LINES 28-40

.. code-block:: default

    metrics_result = exp.model_fairness(model="XGB2_monotonic",
                                        show="metrics",
                                        metric="AIR",
                                        group_category=["Race", "Gender"],
                                        reference_group=[1., 1.],
                                        protected_group=[0., 0.],
                                        favorable_threshold=0.5,
                                        performance_metric="ACC",
                                        return_data=True,
                                        figsize=(5, 4))
    metrics_result.data




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_6_fairness_001.png
   :alt: Adverse Impact Ratio
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_6_fairness_001.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Group Index</th>
          <th>Group Category</th>
          <th>Reference Group</th>
          <th>Protected Group</th>
          <th>AIR</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>0</td>
          <td>Race</td>
          <td>1.0</td>
          <td>0.0</td>
          <td>0.612</td>
        </tr>
        <tr>
          <th>1</th>
          <td>1</td>
          <td>Gender</td>
          <td>1.0</td>
          <td>0.0</td>
          <td>0.745</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 41-42

Fairness Segmented

.. GENERATED FROM PYTHON SOURCE LINES 42-55

.. code-block:: default

    segmented_result = exp.model_fairness(model="XGB2_monotonic",
                                          show="segmented",
                                          metric="AIR",
                                          segment_feature="Balance",
                                          group_category=["Race", "Gender"],
                                          reference_group=[1., 1.],
                                          protected_group=[0., 0.],
                                          favorable_threshold=0.5,
                                          segment_bins=5,
                                          return_data=True,
                                          figsize=(10, 4))
    segmented_result.data




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_6_fairness_002.png
   :alt: Group: 0 (Race), Group: 1 (Gender)
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_6_fairness_002.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Segment</th>
          <th>Lower Bound</th>
          <th>Upper Bound</th>
          <th>0-Race | AIR</th>
          <th>1-Gender | AIR</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>0</td>
          <td>0.97</td>
          <td>306.61</td>
          <td>0.4485</td>
          <td>0.6607</td>
        </tr>
        <tr>
          <th>1</th>
          <td>1</td>
          <td>306.62</td>
          <td>601.40</td>
          <td>0.4767</td>
          <td>0.6426</td>
        </tr>
        <tr>
          <th>2</th>
          <td>2</td>
          <td>601.47</td>
          <td>1027.23</td>
          <td>0.6319</td>
          <td>0.6556</td>
        </tr>
        <tr>
          <th>3</th>
          <td>3</td>
          <td>1027.29</td>
          <td>1864.90</td>
          <td>0.6486</td>
          <td>0.7978</td>
        </tr>
        <tr>
          <th>4</th>
          <td>4</td>
          <td>1864.94</td>
          <td>20384.87</td>
          <td>0.8781</td>
          <td>0.8266</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 56-57

Fairness Binning

.. GENERATED FROM PYTHON SOURCE LINES 57-71

.. code-block:: default

    binning_result = exp.model_fairness(model="XGB2_monotonic", show="binning",
                                        metric="AIR",
                                        group_category=["Race", "Gender"],
                                        reference_group=[1., 1.],
                                        protected_group=[0., 0.],
                                        favorable_threshold=0.5,
                                        performance_metric="F1",
                                        binning_dict={"Balance": {"type": "quantile", "value": [1, 5]},
                                                      "Mortgage": {"type": "uniform", "value": [1, 5]},
                                                      "Amount Past Due": {"type": "custom", "value": (0, 100)}},
                                        return_data=True,
                                        figsize=(10, 4))
    binning_result.data




.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_6_fairness_003.png
   :alt: Group: 0 (Race), Group: 1 (Gender)
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_6_fairness_003.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>ID</th>
          <th>Configuration</th>
          <th>Gender | AIR</th>
          <th>Race | AIR</th>
          <th>F1</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>0</td>
          <td>Original</td>
          <td>0.7450</td>
          <td>0.6120</td>
          <td>0.7163</td>
        </tr>
        <tr>
          <th>1</th>
          <td>1</td>
          <td>Balance: 1, Mortgage: 1, Amount Past Due: (0, 100)</td>
          <td>1.0004</td>
          <td>1.0063</td>
          <td>0.5049</td>
        </tr>
        <tr>
          <th>2</th>
          <td>2</td>
          <td>Balance: 1, Mortgage: 2, Amount Past Due: (0, 100)</td>
          <td>1.0009</td>
          <td>1.0008</td>
          <td>0.5064</td>
        </tr>
        <tr>
          <th>3</th>
          <td>3</td>
          <td>Balance: 1, Mortgage: 3, Amount Past Due: (0, 100)</td>
          <td>1.0032</td>
          <td>0.9776</td>
          <td>0.5127</td>
        </tr>
        <tr>
          <th>4</th>
          <td>4</td>
          <td>Balance: 1, Mortgage: 4, Amount Past Due: (0, 100)</td>
          <td>1.0048</td>
          <td>0.9273</td>
          <td>0.5276</td>
        </tr>
        <tr>
          <th>5</th>
          <td>5</td>
          <td>Balance: 1, Mortgage: 5, Amount Past Due: (0, 100)</td>
          <td>1.0160</td>
          <td>0.8439</td>
          <td>0.5374</td>
        </tr>
        <tr>
          <th>6</th>
          <td>6</td>
          <td>Balance: 2, Mortgage: 1, Amount Past Due: (0, 100)</td>
          <td>0.5674</td>
          <td>0.9873</td>
          <td>0.3577</td>
        </tr>
        <tr>
          <th>7</th>
          <td>7</td>
          <td>Balance: 2, Mortgage: 2, Amount Past Due: (0, 100)</td>
          <td>0.5718</td>
          <td>0.9743</td>
          <td>0.3611</td>
        </tr>
        <tr>
          <th>8</th>
          <td>8</td>
          <td>Balance: 2, Mortgage: 3, Amount Past Due: (0, 100)</td>
          <td>0.5805</td>
          <td>0.9321</td>
          <td>0.3713</td>
        </tr>
        <tr>
          <th>9</th>
          <td>9</td>
          <td>Balance: 2, Mortgage: 4, Amount Past Due: (0, 100)</td>
          <td>0.5921</td>
          <td>0.8310</td>
          <td>0.3991</td>
        </tr>
        <tr>
          <th>10</th>
          <td>10</td>
          <td>Balance: 2, Mortgage: 5, Amount Past Due: (0, 100)</td>
          <td>0.5918</td>
          <td>0.6627</td>
          <td>0.4014</td>
        </tr>
        <tr>
          <th>11</th>
          <td>11</td>
          <td>Balance: 3, Mortgage: 1, Amount Past Due: (0, 100)</td>
          <td>0.4346</td>
          <td>1.0061</td>
          <td>0.3877</td>
        </tr>
        <tr>
          <th>12</th>
          <td>12</td>
          <td>Balance: 3, Mortgage: 2, Amount Past Due: (0, 100)</td>
          <td>0.4388</td>
          <td>0.9928</td>
          <td>0.3915</td>
        </tr>
        <tr>
          <th>13</th>
          <td>13</td>
          <td>Balance: 3, Mortgage: 3, Amount Past Due: (0, 100)</td>
          <td>0.4569</td>
          <td>0.9530</td>
          <td>0.4011</td>
        </tr>
        <tr>
          <th>14</th>
          <td>14</td>
          <td>Balance: 3, Mortgage: 4, Amount Past Due: (0, 100)</td>
          <td>0.4852</td>
          <td>0.8571</td>
          <td>0.4290</td>
        </tr>
        <tr>
          <th>15</th>
          <td>15</td>
          <td>Balance: 3, Mortgage: 5, Amount Past Due: (0, 100)</td>
          <td>0.5129</td>
          <td>0.7078</td>
          <td>0.4340</td>
        </tr>
        <tr>
          <th>16</th>
          <td>16</td>
          <td>Balance: 4, Mortgage: 1, Amount Past Due: (0, 100)</td>
          <td>0.4720</td>
          <td>0.9962</td>
          <td>0.4153</td>
        </tr>
        <tr>
          <th>17</th>
          <td>17</td>
          <td>Balance: 4, Mortgage: 2, Amount Past Due: (0, 100)</td>
          <td>0.4746</td>
          <td>0.9865</td>
          <td>0.4179</td>
        </tr>
        <tr>
          <th>18</th>
          <td>18</td>
          <td>Balance: 4, Mortgage: 3, Amount Past Due: (0, 100)</td>
          <td>0.4921</td>
          <td>0.9476</td>
          <td>0.4276</td>
        </tr>
        <tr>
          <th>19</th>
          <td>19</td>
          <td>Balance: 4, Mortgage: 4, Amount Past Due: (0, 100)</td>
          <td>0.5191</td>
          <td>0.8632</td>
          <td>0.4516</td>
        </tr>
        <tr>
          <th>20</th>
          <td>20</td>
          <td>Balance: 4, Mortgage: 5, Amount Past Due: (0, 100)</td>
          <td>0.5259</td>
          <td>0.6781</td>
          <td>0.4292</td>
        </tr>
        <tr>
          <th>21</th>
          <td>21</td>
          <td>Balance: 5, Mortgage: 1, Amount Past Due: (0, 100)</td>
          <td>0.4835</td>
          <td>1.0036</td>
          <td>0.4054</td>
        </tr>
        <tr>
          <th>22</th>
          <td>22</td>
          <td>Balance: 5, Mortgage: 2, Amount Past Due: (0, 100)</td>
          <td>0.4873</td>
          <td>0.9920</td>
          <td>0.4087</td>
        </tr>
        <tr>
          <th>23</th>
          <td>23</td>
          <td>Balance: 5, Mortgage: 3, Amount Past Due: (0, 100)</td>
          <td>0.5048</td>
          <td>0.9508</td>
          <td>0.4186</td>
        </tr>
        <tr>
          <th>24</th>
          <td>24</td>
          <td>Balance: 5, Mortgage: 4, Amount Past Due: (0, 100)</td>
          <td>0.5227</td>
          <td>0.8739</td>
          <td>0.4412</td>
        </tr>
        <tr>
          <th>25</th>
          <td>25</td>
          <td>Balance: 5, Mortgage: 5, Amount Past Due: (0, 100)</td>
          <td>0.5172</td>
          <td>0.7055</td>
          <td>0.4302</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 72-73

Fairness Thresholding

.. GENERATED FROM PYTHON SOURCE LINES 73-84

.. code-block:: default

    thresholding_result = exp.model_fairness(model="XGB2_monotonic",
                                             show="thresholding",
                                             metric="AIR", 
                                             group_category=["Race", "Gender"],
                                             reference_group=[1., 1.],
                                             protected_group=[0., 0.],
                                             favorable_threshold=0.32,
                                             performance_metric="ACC",
                                             return_data=True,
                                             figsize=(10, 4))
    thresholding_result.data



.. image-sg:: /auto_examples/4_testing/images/sphx_glr_plot_6_fairness_004.png
   :alt: Group: 0 (Race), Group: 1 (Gender)
   :srcset: /auto_examples/4_testing/images/sphx_glr_plot_6_fairness_004.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>Group Index</th>
          <th>Group Category</th>
          <th>Reference Group</th>
          <th>Protected Group</th>
          <th>Threshold</th>
          <th>AIR</th>
          <th>ACC</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>0</td>
          <td>Race</td>
          <td>1.0</td>
          <td>0.0</td>
          <td>0.3324</td>
          <td>0.8862</td>
          <td>0.6757</td>
        </tr>
        <tr>
          <th>1</th>
          <td>1</td>
          <td>Gender</td>
          <td>1.0</td>
          <td>0.0</td>
          <td>0.3324</td>
          <td>0.8917</td>
          <td>0.6757</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  45.841 seconds)

**Estimated memory usage:**  23 MB


.. _sphx_glr_download_auto_examples_4_testing_plot_6_fairness.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/selfexplainml/piml-toolbox/main?urlpath=lab/tree/./docs/_build/html/notebooks/auto_examples/4_testing/plot_6_fairness.ipynb
        :alt: Launch binder
        :width: 150 px



    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_6_fairness.py <plot_6_fairness.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_6_fairness.ipynb <plot_6_fairness.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
