
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\1_train\plot_2_register_2_arbitrary.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_1_train_plot_2_register_2_arbitrary.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_1_train_plot_2_register_2_arbitrary.py:


Register Arbitrary Models
========================================================
If the model is neither sklearn style nor H2O style, we can still register it into PiML.

.. GENERATED FROM PYTHON SOURCE LINES 9-10

For demonstration, we simulate a simple binary classification dataset and fit a GLM using statsmodels.

.. GENERATED FROM PYTHON SOURCE LINES 10-19

.. code-block:: default

    import numpy as np
    import statsmodels.api as sm

    x = np.random.uniform(-1, 1, size=(1000, 2))
    y = (np.sum(x, axis=1) + np.random.normal(0, 0.1, size=(1000,))) > 0.0

    glm_binom = sm.GLM(y, x, family=sm.families.Binomial())
    glm_results  = glm_binom.fit()








.. GENERATED FROM PYTHON SOURCE LINES 20-21

Next, we define the wrapper functions of predict and predict_proba.

.. GENERATED FROM PYTHON SOURCE LINES 21-29

.. code-block:: default

    def predict_proba_func(X):
        proba = glm_binom.predict(glm_results.params, exog=X)
        return np.vstack([1 - proba, proba]).T

    def predict_func(X):
        proba = glm_binom.predict(glm_results.params, exog=X)
        return proba > 0.5








.. GENERATED FROM PYTHON SOURCE LINES 30-31

Register the fitted model into PiML (please make sure the datasets of different pipelines are the same)

.. GENERATED FROM PYTHON SOURCE LINES 31-45

.. code-block:: default

    from piml import Experiment

    exp = Experiment(highcode_only=True)
    pipeline = exp.make_pipeline(predict_func=predict_func,
                                 predict_proba_func=predict_proba_func,
                                 task_type="classification",
                                 train_x=x[:800],
                                 train_y=y[:800],
                                 test_x=x[800:],
                                 test_y=y[800:],
                                 feature_names=["X0", "X1"],
                                 target_name="Y")
    exp.register(pipeline, "Statsmodels-GLM")








.. GENERATED FROM PYTHON SOURCE LINES 46-47

Check model performance

.. GENERATED FROM PYTHON SOURCE LINES 47-49

.. code-block:: default

    exp.model_diagnose(model="Statsmodels-GLM", show="accuracy_table")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

              ACC      AUC      F1 LogLoss   Brier
                                              
    Train  0.9700   0.9971  0.9704  0.0690  0.0216
    Test   0.9750   0.9961  0.9730  0.0791  0.0220
    Gap    0.0050  -0.0010  0.0026  0.0102  0.0003




.. GENERATED FROM PYTHON SOURCE LINES 50-51

Explain using post-hoc explanation tools 

.. GENERATED FROM PYTHON SOURCE LINES 51-53

.. code-block:: default

    exp.model_explain(model="Statsmodels-GLM", show="pfi", figsize=(5, 4))




.. image-sg:: /auto_examples/1_train/images/sphx_glr_plot_2_register_2_arbitrary_001.png
   :alt: Permutation Feature Importance
   :srcset: /auto_examples/1_train/images/sphx_glr_plot_2_register_2_arbitrary_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 54-55

Explain using post-hoc explanation tools 

.. GENERATED FROM PYTHON SOURCE LINES 55-57

.. code-block:: default

    exp.model_explain(model="Statsmodels-GLM", show="ale", uni_feature="X0", figsize=(5, 4))




.. image-sg:: /auto_examples/1_train/images/sphx_glr_plot_2_register_2_arbitrary_002.png
   :alt: Accumulated Local Effects
   :srcset: /auto_examples/1_train/images/sphx_glr_plot_2_register_2_arbitrary_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 58-59

Run validataion tests

.. GENERATED FROM PYTHON SOURCE LINES 59-60

.. code-block:: default

    exp.model_explain(model="Statsmodels-GLM", show="pdp", uni_feature="X0", figsize=(5, 4))



.. image-sg:: /auto_examples/1_train/images/sphx_glr_plot_2_register_2_arbitrary_003.png
   :alt: Partial Dependence Plot
   :srcset: /auto_examples/1_train/images/sphx_glr_plot_2_register_2_arbitrary_003.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  32.525 seconds)

**Estimated memory usage:**  24 MB


.. _sphx_glr_download_auto_examples_1_train_plot_2_register_2_arbitrary.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/selfexplainml/piml-toolbox/main?urlpath=lab/tree/./docs/_build/html/notebooks/auto_examples/1_train/plot_2_register_2_arbitrary.ipynb
        :alt: Launch binder
        :width: 150 px



    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_2_register_2_arbitrary.py <plot_2_register_2_arbitrary.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_2_register_2_arbitrary.ipynb <plot_2_register_2_arbitrary.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
