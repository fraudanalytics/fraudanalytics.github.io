
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\1_train\plot_2_register_1_h2o.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_1_train_plot_2_register_1_h2o.py>`
        to download the full example code or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_1_train_plot_2_register_1_h2o.py:


Register H2O Models
========================================================
Assume we have fitted a H2O model outside PiML workflow

.. GENERATED FROM PYTHON SOURCE LINES 9-10

For demonstration, we fit a model using H2O

.. GENERATED FROM PYTHON SOURCE LINES 10-34

.. code-block:: default

    import h2o
    h2o.no_progress()
    h2o.init(verbose=False)

    import numpy as np
    import pandas as pd
    from sklearn.datasets import fetch_california_housing
    from h2o.estimators import H2OGradientBoostingEstimator

    data = fetch_california_housing()
    feature_names = data.feature_names
    target_name = data.target_names[0]

    h2o_data = h2o.H2OFrame(pd.DataFrame(np.hstack([data.data, data.target.reshape(-1, 1)]),
                                         columns=feature_names + [target_name])
                           )
    h2o_data_train, h2o_data_test = h2o_data.split_frame(ratios=[0.8], seed=2023)

    gbm_model = H2OGradientBoostingEstimator()
    gbm_model.train(feature_names, target_name, training_frame=h2o_data_train)

    # Save the model to file system
    mojo_file_path = gbm_model.save_mojo(path="./")








.. GENERATED FROM PYTHON SOURCE LINES 35-36

Then, we can test this model using PiML

.. GENERATED FROM PYTHON SOURCE LINES 36-39

.. code-block:: default

    from piml import Experiment
    exp = Experiment(highcode_only=True)








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Load the MOJO model into memory and register it into PiML

.. GENERATED FROM PYTHON SOURCE LINES 41-53

.. code-block:: default

    imported_model = h2o.import_mojo(mojo_file_path)

    pipeline = exp.make_pipeline(model=imported_model,
                                 task_type="regression",
                                 train_x=h2o_data_train[feature_names].as_data_frame().values,
                                 train_y=h2o_data_train[target_name].as_data_frame().values.ravel(),
                                 test_x=h2o_data_test[feature_names].as_data_frame().values,
                                 test_y=h2o_data_test[target_name].as_data_frame().values.ravel(),
                                 feature_names=feature_names,
                                 target_name=target_name)
    exp.register(pipeline, "H2O-GBM")








.. GENERATED FROM PYTHON SOURCE LINES 54-55

Check model performance

.. GENERATED FROM PYTHON SOURCE LINES 55-57

.. code-block:: default

    exp.model_diagnose(model="H2O-GBM", show="accuracy_table")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

               MSE     MAE      R2
                              
    Train   0.2423  0.3396  0.8180
    Test    0.2377  0.3429  0.8216
    Gap    -0.0046  0.0033  0.0037




.. GENERATED FROM PYTHON SOURCE LINES 58-59

Explain using post-hoc explanation tools 

.. GENERATED FROM PYTHON SOURCE LINES 59-61

.. code-block:: default

    exp.model_explain(model="H2O-GBM", show="pfi", figsize=(5, 4))




.. image-sg:: /auto_examples/1_train/images/sphx_glr_plot_2_register_1_h2o_001.png
   :alt: Permutation Feature Importance
   :srcset: /auto_examples/1_train/images/sphx_glr_plot_2_register_1_h2o_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 62-63

Run validataion tests

.. GENERATED FROM PYTHON SOURCE LINES 63-64

.. code-block:: default

    exp.model_diagnose(model="H2O-GBM", show="weakspot", slice_features=["MedInc"], figsize=(5, 4))



.. image-sg:: /auto_examples/1_train/images/sphx_glr_plot_2_register_1_h2o_002.png
   :alt: Weak Regions
   :srcset: /auto_examples/1_train/images/sphx_glr_plot_2_register_1_h2o_002.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 5 minutes  55.568 seconds)

**Estimated memory usage:**  34 MB


.. _sphx_glr_download_auto_examples_1_train_plot_2_register_1_h2o.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/selfexplainml/piml-toolbox/main?urlpath=lab/tree/./docs/_build/html/notebooks/auto_examples/1_train/plot_2_register_1_h2o.ipynb
        :alt: Launch binder
        :width: 150 px



    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_2_register_1_h2o.py <plot_2_register_1_h2o.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_2_register_1_h2o.ipynb <plot_2_register_1_h2o.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
